<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在 pipeline 中使用 | 钉钉机器人插件</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="在 Jenkins 中使用钉钉机器人发送消息">
    <link rel="preload" href="/dingtalk-plugin/assets/css/0.styles.c244bf36.css" as="style"><link rel="preload" href="/dingtalk-plugin/assets/js/app.c8d6e7cf.js" as="script"><link rel="preload" href="/dingtalk-plugin/assets/js/2.acfccf3a.js" as="script"><link rel="preload" href="/dingtalk-plugin/assets/js/14.42cdf32b.js" as="script"><link rel="preload" href="/dingtalk-plugin/assets/js/6.9a2290a9.js" as="script"><link rel="prefetch" href="/dingtalk-plugin/assets/js/10.a8507e98.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/11.8f4baf47.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/12.4ac0ae6e.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/13.a6c61357.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/15.17915371.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/16.eada2edf.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/3.2c32125b.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/4.ee498678.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/5.c1a8eb1f.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/7.957324c8.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/8.16d6dfd5.js"><link rel="prefetch" href="/dingtalk-plugin/assets/js/9.9e0daf93.js">
    <link rel="stylesheet" href="/dingtalk-plugin/assets/css/0.styles.c244bf36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dingtalk-plugin/" class="home-link router-link-active"><!----> <span class="site-name">钉钉机器人插件</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/jenkinsci/dingtalk-plugin/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  发布记录
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/jenkinsci/dingtalk-plugin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/jenkinsci/dingtalk-plugin/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  发布记录
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/jenkinsci/dingtalk-plugin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/dingtalk-plugin/guide/getting-started" class="sidebar-heading clickable open"><span>指南</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dingtalk-plugin/guide/getting-started.html" class="sidebar-link">快速开始</a></li><li><a href="/dingtalk-plugin/guide/freestyle.html" class="sidebar-link">在 freestyle 项目中使用</a></li><li><a href="/dingtalk-plugin/guide/pipeline.html" aria-current="page" class="active sidebar-link">在 pipeline 中使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dingtalk-plugin/guide/pipeline.html#语法" class="sidebar-link">语法</a></li><li class="sidebar-sub-header"><a href="/dingtalk-plugin/guide/pipeline.html#参数说明" class="sidebar-link">参数说明</a></li><li class="sidebar-sub-header"><a href="/dingtalk-plugin/guide/pipeline.html#默认设置" class="sidebar-link">默认设置</a></li><li class="sidebar-sub-header"><a href="/dingtalk-plugin/guide/pipeline.html#效果展示" class="sidebar-link">效果展示</a></li><li class="sidebar-sub-header"><a href="/dingtalk-plugin/guide/pipeline.html#其他" class="sidebar-link">其他</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dingtalk-plugin/advance/getting-started" class="sidebar-heading clickable"><span>进阶</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dingtalk-plugin/advance/user-property.html" class="sidebar-link">用户属性扩展</a></li><li><a href="/dingtalk-plugin/advance/markdown.html" class="sidebar-link">Markdown</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/dingtalk-plugin/examples/freestyleAdvanced" class="sidebar-heading clickable"><span>示例</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/dingtalk-plugin/examples/freestyleAdvanced.html" class="sidebar-link">Freestyle 项目高级功能</a></li><li><a href="/dingtalk-plugin/examples/text.html" class="sidebar-link">TEXT 类型的消息</a></li><li><a href="/dingtalk-plugin/examples/link.html" class="sidebar-link">LINK 类型的消息</a></li><li><a href="/dingtalk-plugin/examples/markdown.html" class="sidebar-link">MARKDOWN 类型的消息</a></li><li><a href="/dingtalk-plugin/examples/actionCardSingle.html" class="sidebar-link">ACTION_CARD 整体跳转</a></li><li><a href="/dingtalk-plugin/examples/actionCardMultiple.html" class="sidebar-link">ACTION_CARD 整体跳转</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="在-pipeline-中使用"><a href="#在-pipeline-中使用" class="header-anchor">#</a> 在 pipeline 中使用</h1> <p>取消项目中勾选的机器人，防止重复发送消息。</p> <h2 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h2> <div class="language-groovy extra-class"><pre class="language-groovy"><code>
dingtalk <span class="token punctuation">(</span>
    robot<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    at<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    atAll<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    title<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    messageUrl<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    picUrl<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    singleTitle<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    btns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    btnLayout<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    hideAvatar<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span>

</code></pre></div><h2 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h2> <h3 id="通用的参数"><a href="#通用的参数" class="header-anchor">#</a> 通用的参数</h3> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>robot</td> <td style="text-align:center;">String</td> <td>机器人 id</td></tr> <tr><td>type</td> <td style="text-align:center;"><a href="#MsgTypeEnum">MsgTypeEnum</a></td> <td>消息类型</td></tr> <tr><td>at</td> <td style="text-align:center;">List&lt;String&gt;</td> <td>需要 @ 的手机号码</td></tr> <tr><td>atAll</td> <td style="text-align:center;">boolean</td> <td>是否 @ 全部</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>robot</code> 参数可以在机器人配置中找到。</p></div> <details class="custom-block details"><summary>查看详情</summary> <p><img src="/dingtalk-plugin/assets/img/robotId.9a0f8e74.jpg" alt="robotId.jpg"></p></details> <h3 id="msgtypeenum"><a href="#msgtypeenum" class="header-anchor">#</a> MsgTypeEnum</h3> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">MsgTypeEnum</span> <span class="token punctuation">{</span>
  TEXT<span class="token punctuation">,</span>

  LINK<span class="token punctuation">,</span>

  MARKDOWN<span class="token punctuation">,</span>

  ACTION_CARD
<span class="token punctuation">}</span>

</code></pre></div><h3 id="text-类型的消息"><a href="#text-类型的消息" class="header-anchor">#</a> TEXT 类型的消息</h3> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>text</td> <td style="text-align:center;">List&lt;String&gt;</td> <td>发送文本消息</td></tr></tbody></table> <h3 id="link-类型的消息"><a href="#link-类型的消息" class="header-anchor">#</a> LINK 类型的消息</h3> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>title</td> <td style="text-align:center;">String</td> <td>消息标题</td></tr> <tr><td>text</td> <td style="text-align:center;">List&lt;String&gt;</td> <td>消息内容，如果太长只会部分展示</td></tr> <tr><td>messageUrl <span class="badge error" style="vertical-align:top;" data-v-15b7b770>必填</span></td> <td style="text-align:center;">String</td> <td>点击消息跳转的 URL</td></tr> <tr><td>picUrl</td> <td style="text-align:center;">String</td> <td>图片 URL</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>该类型的消息不支持 At 功能。</p></div> <h3 id="markdown-类型的消息"><a href="#markdown-类型的消息" class="header-anchor">#</a> MARKDOWN 类型的消息</h3> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>title</td> <td style="text-align:center;">String</td> <td><a href="#%E9%A6%96%E5%B1%8F%E4%BC%9A%E8%AF%9D">首屏会话</a> 透出的展示内容</td></tr> <tr><td>text</td> <td style="text-align:center;">List&lt;String&gt;</td> <td>消息内容，支持 [受限的 markdonw](#受限的 markdonw) 语法</td></tr></tbody></table> <h3 id="action-card-类型的消息"><a href="#action-card-类型的消息" class="header-anchor">#</a> ACTION_CARD 类型的消息</h3> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>title</td> <td style="text-align:center;">String</td> <td><a href="#%E9%A6%96%E5%B1%8F%E4%BC%9A%E8%AF%9D">首屏会话</a> 透出的展示内容</td></tr> <tr><td>text</td> <td style="text-align:center;">List&lt;String&gt;</td> <td>消息内容，支持 [受限的 markdonw](#受限的 markdonw) 语法</td></tr> <tr><td>btnLayout</td> <td style="text-align:center;"><a href="#BtnLayoutEnum">BtnLayoutEnum</a></td> <td>按钮的排列方式</td></tr> <tr><td>hideAvatar</td> <td style="text-align:center;">boolean</td> <td>是否隐藏发消息者头像</td></tr></tbody></table> <h3 id="btnlayoutenum"><a href="#btnlayoutenum" class="header-anchor">#</a> BtnLayoutEnum</h3> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">BtnLayoutEnum</span> <span class="token punctuation">{</span>

  <span class="token comment">/**
   * horizotal：水平排列
   */</span>
  <span class="token class-name">H</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * vertical：垂直排列
   */</span>
  <span class="token class-name">V</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre></div><h4 id="整体跳转"><a href="#整体跳转" class="header-anchor">#</a> 整体跳转</h4> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>singleTitle</td> <td style="text-align:center;">String</td> <td>单个按钮的方案（设置此项和 <code>singleUrl</code> 后 <code>btns</code> 无效）</td></tr> <tr><td>singleUrl</td> <td style="text-align:center;">String</td> <td>点击 <code>singleTitle</code> 按钮触发的 URL</td></tr></tbody></table> <h4 id="独立跳转"><a href="#独立跳转" class="header-anchor">#</a> 独立跳转</h4> <table><thead><tr><th>参数</th> <th style="text-align:center;">类型</th> <th>说明</th></tr></thead> <tbody><tr><td>btns</td> <td style="text-align:center;">List&lt;<a href="#ButtonModel">ButtonModel</a>&gt;</td> <td>自定义按钮组</td></tr></tbody></table> <h3 id="buttonmodel"><a href="#buttonmodel" class="header-anchor">#</a> ButtonModel</h3> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ButtonModel</span><span class="token punctuation">{</span>

  <span class="token comment">/**
   * 按钮标题
   */</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

  <span class="token comment">/**
   * 点击按钮跳转的链接
   */</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> actionUrl<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="默认设置"><a href="#默认设置" class="header-anchor">#</a> 默认设置</h2> <h3 id="title-参数"><a href="#title-参数" class="header-anchor">#</a> title 参数</h3> <p>当参数为空时，默认会使用 <em>Jenkins 通知</em>。</p> <h3 id="action-card-类型的消息-2"><a href="#action-card-类型的消息-2" class="header-anchor">#</a> ACTION_CARD 类型的消息</h3> <p>当 <code>singleTitle</code> 与 <code>btns</code> 都为空时，默认会创建 『更改记录』『控制台』 2 个按钮。</p> <h2 id="效果展示"><a href="#效果展示" class="header-anchor">#</a> 效果展示</h2> <h3 id="text-消息"><a href="#text-消息" class="header-anchor">#</a> TEXT 消息</h3> <details class="custom-block details"><summary>点击查看</summary> <p><img src="https://img.alicdn.com/tfs/TB1jFpqaRxRMKJjy0FdXXaifFXa-497-133.png" alt="text"></p></details> <h3 id="link-消息"><a href="#link-消息" class="header-anchor">#</a> LINK 消息</h3> <details class="custom-block details"><summary>点击查看</summary> <p><img src="https://ding-doc.oss-cn-beijing.aliyuncs.com/images/0.0.239/1570679827267-6243216b-d1c3-48b7-9b1e-0f0b4211b50b.png" alt="link"></p></details> <h3 id="markdown-消息"><a href="#markdown-消息" class="header-anchor">#</a> MARKDOWN 消息</h3> <details class="custom-block details"><summary>点击查看</summary> <p><img src="https://img.alicdn.com/tfs/TB1yL3taUgQMeJjy0FeXXXOEVXa-492-380.png" alt="markdown"></p></details> <h3 id="action-card-整体跳转"><a href="#action-card-整体跳转" class="header-anchor">#</a> ACTION_CARD 整体跳转</h3> <details class="custom-block details"><summary>点击查看</summary> <p><img src="https://img.alicdn.com/tfs/TB1nhWCiBfH8KJjy1XbXXbLdXXa-547-379.png" alt="actionCard"></p></details> <h3 id="action-card-独立跳转"><a href="#action-card-独立跳转" class="header-anchor">#</a> ACTION_CARD 独立跳转</h3> <details class="custom-block details"><summary>点击查看</summary> <p><img src="https://ding-doc.oss-cn-beijing.aliyuncs.com/images/0.0.239/1570679939723-c1fb7861-5bcb-4c30-9e1b-033932f6b72f.png" alt="actionCard"></p></details> <h3 id="首屏会话"><a href="#首屏会话" class="header-anchor">#</a> 首屏会话</h3> <details class="custom-block details"><summary>点击查看</summary> <p><img src="https://img.alicdn.com/tfs/TB1ehWCiBfH8KJjy1XbXXbLdXXa-334-218.png" alt="首屏会话"></p></details> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <p>更多细节请参考 <a href="/examples/text">示例</a> 章节</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/jenkinsci/dingtalk-plugin/edit/master/docs/guide/pipeline.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/10/2020, 10:01:33 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dingtalk-plugin/guide/freestyle.html" class="prev">
        在 freestyle 项目中使用
      </a></span> <span class="next"><a href="/dingtalk-plugin/advance/user-property.html">
        用户属性扩展
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/dingtalk-plugin/assets/js/app.c8d6e7cf.js" defer></script><script src="/dingtalk-plugin/assets/js/2.acfccf3a.js" defer></script><script src="/dingtalk-plugin/assets/js/14.42cdf32b.js" defer></script><script src="/dingtalk-plugin/assets/js/6.9a2290a9.js" defer></script>
  </body>
</html>
